# Simplified `ZENITH` Specification, Tailored for `NADIR`

Here we have a slightly modified specification of `ZENITH` with no OFC Failover involved.
In this specification, a few things have been changed:
- The locks `switchLock` and `controllerLock` are removed, as they confuse `NADIR`. These locks serve no verification purposes, they only 
make certain trivially OK interleavings of processes impossible and help the verification scale. We have removed them (and we pay the price in verification time later).
- Module failure is not a thing in this code (of course, `NADIR` ifself cannot create code that knows in advance when a module fails, it is an asynchronous signal in implementation), thus each invocation of `controllerModuleFailsOrNot` (which creates branches for whether or not a module fails before executing a certain series of instructions), is replaced with a label (which we use later to signal module failures by using them as a breakpoint, and then killing the module).
- Queues have been abstracted away. `NADIR` does not like seeing iterations on a queue (of course, that means that it is a list not a queue), but TLA+ only has sequences as elementary types, so we create specific macros that signal to `NADIR` what queue operations we are doing. These macros are:
    - `NadirFIFOPut`, `NadirFIFOPop`, `NadirFIFOGet`, `NadirFIFOPeek`: These are operations on persistent FIFO queues. All data in TLA+ is persistent by design, since there is no concept of failure until a user adds it, but queues are part of the NIB by default, which is persistent. Thus, we define a _Peek_ operation for queues, which means that we just read what is on the head of the queue and move on.
    - `NadirAckQueuePut`, `NadirAckQueueGet`, `NadirAckQueueAck`: These are operations on a persistent Acknowledgement Queue instance. In practice, even the FIFO queues are implemented as AckQueue instances, since that is the only way to support Peek operations without running into multiple reads of the same object.
    - `NadirFIFOPeekWithTimeout`: A Peek operation that has a timeout. If the queue remains empty, it returns a `NADIR_NULL` for its message. The reason that we introduce this is because in practice, there is no clean way of asking a queue its length, thus non-blocking statements that are conditional on the queue length are problematic. This macro helps handle such situations while signaling to `NADIR` what is the best way of looking at these in practice.
- Flow numbers have been removed entirely. IRs are only addressed with their IDs, and that is enough in practice, since IRs in the context of OpenFlow (which is what we use), are indistinguisable from _flows_.
- This specification contains an extra invariant, the `TypeOK` invariant, which should be familiar to users of TLA+. In `NADIR`, we need this invariant to assert the type of variables to instantiate, and to distinguish what is actually a list and what is actually a queue.
